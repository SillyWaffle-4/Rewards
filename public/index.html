<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Awards Dashboard</title>
    <style>
        :root {
            /* Neon Dark Mode Variables */
            --aiden-color: #00d2ff;
            --ethan-color: #9d50bb;
            --bg-color: #0f172a;
            --card-bg: rgba(255, 255, 255, 0.05);
            --text-color: #f8fafc;
            --border-color: rgba(255, 255, 255, 0.1);
            --label-bg: rgba(255, 255, 255, 0.03);
            --input-bg: rgba(0, 0, 0, 0.3);
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        /* Light Mode Overrides */
        body.light-mode {
            --bg-color: #f0f2f5;
            --card-bg: rgba(255, 255, 255, 0.9);
            --text-color: #1e293b;
            --border-color: rgba(0, 0, 0, 0.1);
            --label-bg: rgba(0, 0, 0, 0.05);
            --input-bg: #ffffff;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        body { 
            font-family: 'Poppins', 'Segoe UI', sans-serif; 
            margin: 0; 
            padding: 20px;
            background: var(--bg-color); 
            color: var(--text-color); 
            min-height: 100vh;
            transition: background 0.4s ease, color 0.4s ease;
        }

        /* Floating Theme Toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow);
            transition: transform 0.2s;
        }
        .theme-toggle:active { transform: scale(0.9); }

        .header { text-align: center; margin-bottom: 40px; padding-top: 20px; }
        h1 { font-size: 2.5em; letter-spacing: -1px; margin-bottom: 20px; }

        .admin-box {
            background: var(--card-bg);
            padding: 15px;
            display: inline-flex;
            gap: 10px;
            border-radius: 15px;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(5px);
        }

        .columns-container { 
            display: flex; 
            justify-content: center; 
            gap: 30px; 
            flex-wrap: wrap; 
            max-width: 1200px;
            margin: 0 auto;
        }

        .column { 
            background: var(--card-bg); 
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 30px; 
            border-radius: 24px; 
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            flex: 1; 
            min-width: 340px; 
            max-width: 450px;
            transition: transform 0.3s ease;
        }
        
        .column:hover { transform: translateY(-5px); }
        .aiden-card { border-top: 6px solid var(--aiden-color); }
        .ethan-card { border-top: 6px solid var(--ethan-color); }

        .score-display { font-size: 3.5em; font-weight: 800; margin: 15px 0; font-variant-numeric: tabular-nums; }
        .aiden-card .score-display { color: var(--aiden-color); text-shadow: 0 0 20px rgba(0, 210, 255, 0.2); }
        .ethan-card .score-display { color: var(--ethan-color); text-shadow: 0 0 20px rgba(157, 80, 187, 0.2); }

        label { 
            display: flex; 
            align-items: center;
            padding: 12px 15px; 
            margin: 8px 0;
            border-radius: 12px; 
            background: var(--label-bg);
            cursor: pointer; 
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        
        label:hover { 
            background: rgba(128,128,128,0.1); 
            border-color: var(--border-color);
            padding-left: 20px;
        }

        .task-val { margin-left: auto; font-weight: 600; opacity: 0.7; }
        .negative { color: #ff4d4d; }

        input[type="checkbox"] { 
            appearance: none;
            height: 22px; width: 22px;
            background: rgba(128,128,128,0.2);
            border-radius: 6px;
            cursor: pointer;
            margin-right: 15px;
            display: flex; align-items: center; justify-content: center;
        }
        input[type="checkbox"]:checked { background: #26c84c; }
        input[type="checkbox"]:checked::after { content: '‚úî'; color: white; font-size: 14px; }
        input[type="checkbox"]:disabled { opacity: 0.3; cursor: not-allowed; }

        input[type="password"], input[type="number"] { 
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 12px;
            border-radius: 10px;
            outline: none;
        }

        button { 
            padding: 12px; 
            background: #26c84c; 
            color: white; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer; 
            font-weight: 600; 
            transition: all 0.3s;
        }
        button:hover:not(:disabled) { background: #1db843; transform: scale(1.02); }
        
        .reset-btn { 
            background: transparent; 
            border: 1px solid #ff4d4d; 
            color: #ff4d4d; 
            margin: 50px auto;
            display: block;
            width: 100%;
            max-width: 300px;
        }
        .reset-btn:hover { background: #ff4d4d; color: white; }

        hr { border: 0; border-top: 1px solid var(--border-color); margin: 25px 0; }

        link {
            color: var(--text-color);
            text-decoration: underline;
            display: block;
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body class="dark-mode">

    <button class="theme-toggle" onclick="toggleTheme()" id="theme-btn">üåô</button>

    <div class="header">
        <h1>üèÜ FAMILY AWARDS</h1>
        <div class="admin-box">
            <input type="password" id="password" placeholder="Admin Key">
            <button onclick="checkAdmin()">Unlock</button>
        </div>
    </div>

    <div class="columns-container">
        <div class="column aiden-card">
            <h2>Aiden</h2>
            <div class="score-display"><span id="points-aiden">0</span> <small style="font-size: 0.3em; opacity: 0.5;">PTS</small></div>
            <div id="aiden-tasks">
                <label><input type="checkbox" id="Flute" disabled onclick="handleToggle(this, 10, 'aiden')"><span>Flute</span><span class="task-val">+10</span></label>
                <label><input type="checkbox" id="Aplus" disabled onclick="handleToggle(this, 15, 'aiden')"><span>A+ Class</span><span class="task-val">+15</span></label>
                <label><input type="checkbox" id="BYSO" disabled onclick="handleToggle(this, 13, 'aiden')"><span>BYSO</span><span class="task-val">+13</span></label>
                <label><input type="checkbox" id="Chinese" disabled onclick="handleToggle(this, 10, 'aiden')"><span>Chinese</span><span class="task-val">+10</span></label>
                <label><input type="checkbox" id="PythonClass" disabled onclick="handleToggle(this, 5, 'aiden')"><span>Python Class</span><span class="task-val">+10</span></label>
            </div>
            <hr>
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <input type="number" id="custom-aiden" placeholder="Custom Points">
                <button onclick="manualAdd('custom-aiden', 'aiden')">Update Aiden</button>
            </div>
        </div>

        <div class="column ethan-card">
            <h2>Ethan</h2>
            <div class="score-display"><span id="points-ethan">0</span> <small style="font-size: 0.3em; opacity: 0.5;">PTS</small></div>
            <div id="ethan-tasks">
                <label><input type="checkbox" id="Piano" disabled onclick="handleToggle(this, 10, 'ethan')"><span>Piano</span><span class="task-val">+10</span></label>
                <label><input type="checkbox" id="AplusE" disabled onclick="handleToggle(this, 15, 'ethan')"><span>A+ Grade</span><span class="task-val">+15</span></label>
                <label><input type="checkbox" id="Spanish" disabled onclick="handleToggle(this, 10, 'ethan')"><span>Chinese</span><span class="task-val">+10</span></label>
                <label><input type="checkbox" id="Swimming" disabled onclick="handleToggle(this, 10, 'ethan')"><span>Swimming</span><span class="task-val">+10</span></label>
                <label><input type="checkbox" id="Points25E" disabled onclick="handleToggle(this, 25, 'ethan')"><span>Bonus Task</span><span class="task-val">+25</span></label>
            </div>
            <hr>
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <input type="number" id="custom-ethan" placeholder="Custom Points">
                <button onclick="manualAdd('custom-ethan', 'ethan')">Update Ethan</button>
            </div>
        </div>
    </div>

    <button class="reset-btn" onclick="resetPoints()">Manual Monday Reset</button>
    <a href="https://docs.google.com/document/d/1c_uETrcuRJw_Qqme4VV3S06sPhnKgGlyqk5t7k-mM0A/edit?tab=t.0" target="_blank">Access Rulebook</a>

    <script>
        let admin = false;

        // THEME TOGGLE
        function toggleTheme() {
            const body = document.body;
            const btn = document.getElementById('theme-btn');
            body.classList.toggle('light-mode');
            const isLight = body.classList.contains('light-mode');
            btn.innerText = isLight ? '‚òÄÔ∏è' : 'üåô';
            localStorage.setItem('theme', isLight ? 'light' : 'dark');
        }

        // LOAD STARTUP DATA
        window.onload = async () => {
            // Load theme
            if(localStorage.getItem('theme') === 'light') {
                document.body.classList.add('light-mode');
                document.getElementById('theme-btn').innerText = '‚òÄÔ∏è';
            }
            // Load Points
            const res = await fetch('/get-points');
            const data = await res.json();
            updateUI(data);
        };

        async function updateUI(data) {
            document.getElementById('points-aiden').innerText = data.aidenPoints || 0;
            document.getElementById('points-ethan').innerText = data.ethanPoints || 0;
            // Clear all boxes first, then check the completed ones
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            if (data.completedTasks) {
                data.completedTasks.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.checked = true;
                });
            }
        }

        async function checkAdmin() {
            const pass = document.getElementById('password').value;
            const res = await fetch('/check-admin', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password: pass })
            });
            const result = await res.json();
            if (result.success) {
                admin = true;
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.disabled = false);
                alert('Admin Unlocked!');
            } else { alert('Access Denied!'); }
        }

        async function handleToggle(checkbox, points, userType) {
            const route = checkbox.checked ? '/give-points' : '/remove-points';
            const res = await fetch(route, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    points: Math.abs(points), 
                    taskId: checkbox.id, 
                    userType: userType 
                })
            });
            updateUI(await res.json());
        }

        async function manualAdd(inputId, userType) {
            const val = document.getElementById(inputId).value;
            if(!val) return;
            const res = await fetch('/give-points', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    points: val, 
                    taskId: 'manual-' + Date.now(), 
                    userType: userType 
                })
            });
            updateUI(await res.json());
            document.getElementById(inputId).value = '';
        }

        async function resetPoints() {
            if (!admin) return alert('Unlock Admin first!');
            if (!confirm('Are you sure you want to reset everything?')) return;
            const res = await fetch('/reset-points', { method: 'POST' });
            updateUI(await res.json());
            alert('Scores reset for the new week!');
        }

        // A link for a docs page
        //makes you go to the window for the google docs
        const docsLink = document.createElement('a');
        docsLink.href = 'https://docs.google.com/document/d/1c_uETrcuRJw_Qqme4VV3S06sPhnKgGlyqk5t7k-mM0A/edit?tab=t.0'
    </script>
</body>
</html>